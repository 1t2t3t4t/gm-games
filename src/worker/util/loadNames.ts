import type { Names, PlayerNames } from "../../common/types";
import g from "./g";

// The names were generated by tools/names.js, you probably don't want to edit them by hand.
// If the list of countries changes, update the fake age code in getPlayerFakeAge.js!
// This is dynamically resolved with rollup-plugin-alias
import names from "player-names"; // eslint-disable-line

const genCumSums = (names: {
	[key: string]: [string, number][] | undefined;
}): [string, number][] => {
	let cumsum = 0;
	return Object.keys(names)
		.sort()
		.map(country => {
			const namesCountry = names[country];
			if (namesCountry) {
				cumsum += namesCountry[namesCountry.length - 1][1];
			}
			return [country, cumsum];
		});
};

const loadNames = (): PlayerNames => {
	let { first, last } = (names as unknown) as Names;

	const gNames = g.get("names");
	if (gNames) {
		// eslint-disable-next-line @typescript-eslint/strict-boolean-expressions
		if (gNames.first) {
			if (Array.isArray(gNames.first)) {
				first = {
					USA: gNames.first,
				};
			} else {
				first = gNames.first;
			}
		}

		// eslint-disable-next-line @typescript-eslint/strict-boolean-expressions
		if (gNames.last) {
			if (Array.isArray(gNames.last)) {
				last = {
					USA: gNames.last,
				};
			} else {
				last = gNames.last;
			}
		}
	}

	const countries = genCumSums(first);
	/*const max = countries[countries.length - 1][1];
     let prev = 0;
     for (const row of countries) {
         console.log(`${row[0]} ${(100 * (row[1] - prev) / max).toFixed(3)}%`);
         prev = row[1];
     }*/

	return {
		countries,
		first,
		last,
	};
};

export default loadNames;
